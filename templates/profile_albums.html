{% extends 'base.html' %}
{% load static %}

{% block title %}Albums - {{ profile_user.first_name }}{% endblock %}

{% block content %}
<div class="lg:flex 2xl:gap-16 gap-12 max-w-[1065px] mx-auto bg-gray-100 dark:bg-dark1 min-h-screen" id="js-oversized">

  <div class="max-w-[980px] mx-auto w-full">

    <!-- Header -->
    <div class="flex items-center justify-between mt-6 mb-4">
      <div>
        <h1 class="text-2xl font-extrabold text-gray-800">Albums de {{ profile_user.first_name }} {{ profile_user.last_name }}</h1>
        <p class="text-gray-500 text-sm">Organis√©s automatiquement par destination (IA)</p>
      </div>
      <a href="{% url 'profile' profile.slug %}" class="text-blue-600 hover:text-blue-700 font-medium">‚Üê Retour au profil</a>
    </div>

    <!-- Filtres (Dropdown simple via <details>) -->
    <div class="bg-white rounded-xl shadow-sm p-3 mb-6">
      <div class="flex items-center gap-3">
        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
        <details class="relative w-full">
          <summary class="cursor-pointer list-none w-full flex items-center justify-between px-4 py-2.5 rounded-lg border-2 bg-white text-gray-700 border-gray-200 hover:border-blue-300 hover:bg-gray-50">
            <div class="flex items-center gap-3">
              <span class="text-lg">
                {% if current_category == 'all' %}
                  üåç
                {% else %}
                  {% for c in categories %}{% if c.id == current_category %}{{ c.icon }}{% endif %}{% endfor %}
                {% endif %}
              </span>
              <span class="font-semibold text-sm">Filtrer :
                {% if current_category == 'all' %}
                  Tous <span class="text-blue-600 font-bold">({{ categories.0.count }})</span>
                {% else %}
                  {% for c in categories %}{% if c.id == current_category %}{{ c.name }} <span class="text-blue-600 font-bold">({{ c.count }})</span>{% endif %}{% endfor %}
                {% endif %}
              </span>
            </div>
            <span class="text-xl">‚ñæ</span>
          </summary>
          <div class="absolute z-50 w-full mt-2 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden">
            {% for c in categories %}
            <a href="?category={{ c.id }}" class="flex items-center justify-between px-4 py-3 transition-colors duration-150 {% if current_category == c.id %}bg-blue-50 text-blue-700 border-l-4 border-blue-600{% else %}text-gray-700 hover:bg-gray-50 border-l-4 border-transparent{% endif %}">
              <div class="flex items-center gap-3">
                {% if current_category == c.id %}<span class="text-blue-600">‚úì</span>{% else %}<span class="w-3"></span>{% endif %}
                <span class="text-xl">{{ c.icon }}</span>
                <span class="font-medium">{{ c.name }}</span>
              </div>
              <span class="px-2.5 py-0.5 rounded-full text-xs font-bold {% if current_category == c.id %}bg-blue-600 text-white{% else %}{% if c.count > 0 %}bg-blue-100 text-blue-700{% else %}bg-gray-100 text-gray-400{% endif %}{% endif %}">{{ c.count }}</span>
            </a>
            {% endfor %}
          </div>
        </details>
        {% if current_category != 'all' %}
        <a href="?" class="flex-shrink-0 flex items-center gap-1.5 px-4 py-2.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors duration-200 text-sm font-medium border-2 border-red-200 hover:border-red-300">Effacer</a>
        {% endif %}
      </div>
    </div>

    <!-- Grid d'images -->
    {% if images %}
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
      {% for p in images %}
      <a href="{% url 'get_post_detail' p.id %}" class="group block overflow-hidden rounded-xl bg-gray-200">
        {% if p.image and p.image.name %}
        <img src="{{ p.image.url }}" alt="" loading="lazy" class="w-full h-44 object-cover group-hover:scale-[1.03] transition-transform duration-200"/>
        {% else %}
        <div class="w-full h-44 grid place-items-center text-gray-400 bg-gray-100">
          <span class="text-sm">Image manquante</span>
        </div>
        {% endif %}
      </a>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-center gap-2 mt-6">
      {% if page_obj.has_previous %}
      <a href="?category={{ current_category }}&page={{ page_obj.previous_page_number }}" class="px-3 py-1.5 rounded-lg bg-white border hover:bg-gray-50">Pr√©c√©dent</a>
      {% endif %}
      <span class="text-sm text-gray-600">Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
      <a href="?category={{ current_category }}&page={{ page_obj.next_page_number }}" class="px-3 py-1.5 rounded-lg bg-white border hover:bg-gray-50">Suivant</a>
      {% endif %}
    </div>
    {% else %}
    <div class="bg-white rounded-xl shadow-sm p-12 text-center">
      <h3 class="text-lg font-semibold text-gray-700 mb-2">Aucune image dans cet album</h3>
      <p class="text-gray-500">Choisissez une autre cat√©gorie ou publiez une image.</p>
    </div>
    {% endif %}

  </div>

</div>
{% endblock %}


